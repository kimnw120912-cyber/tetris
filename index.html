<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¦´ë¼ì˜ í…ŒíŠ¸ë¦¬ìŠ¤</title>

<style>
body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: #282c34;
    color: white;
    font-family: 'Malgun Gothic', sans-serif;
    margin: 0;
}

.game-container {
    display: flex;
    gap: 30px;
    padding: 20px;
    border: 5px solid #61dafb;
    background-color: #383c44;
    border-radius: 8px;
}

#game-board {
    display: grid;
    grid-template-columns: repeat(10, 30px);
    grid-template-rows: repeat(20, 30px);
    width: 300px;
    height: 600px;
    background: black;
    border: 2px solid #aaa;
}

.cell {
    width: 30px;
    height: 30px;
    border: 1px solid rgba(255,255,255,0.05);
}

.block {
    border: 2px solid rgba(0,0,0,0.3);
    box-shadow: inset 0 0 8px rgba(255,255,255,0.4);
}

.i-block { background:#00f0f0; }
.j-block { background:#0000f0; }
.l-block { background:#f0a000; }
.o-block { background:#f0f000; }
.s-block { background:#00f000; }
.t-block { background:#a000f0; }
.z-block { background:#f00000; }

.info-panel {
    width: 180px;
    text-align: center;
}

.next-preview {
    width: 100px;
    height: 100px;
    margin: auto;
    display: grid;
    grid-template-columns: repeat(4,1fr);
    grid-template-rows: repeat(4,1fr);
    background:#111;
    border:2px solid #555;
}

.preview-cell {
    border:1px solid rgba(255,255,255,0.05);
}

button {
    cursor:pointer;
    font-weight:bold;
}

#start-button {
    padding: 10px;
    background:#61dafb;
    border:none;
    border-radius:5px;
    margin-top:10px;
}

/* ğŸ“± ëª¨ë°”ì¼ ì»¨íŠ¸ë¡¤ */
.mobile-controls {
    position: fixed;
    bottom: 15px;
    width: 100%;
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.mobile-controls .row {
    display: flex;
    gap: 10px;
}

.mobile-controls button {
    width: 60px;
    height: 60px;
    font-size: 1.4em;
    border-radius: 10px;
    border: none;
    background: #61dafb;
}

.mobile-controls .drop {
    width: 200px;
}

/* ëª¨ë°”ì¼ì—ì„œë§Œ í‘œì‹œ */
@media (max-width: 768px) {
    .mobile-controls {
        display: flex;
    }
}
</style>
</head>

<body>

<div class="game-container">
    <div id="game-board"></div>

    <div class="info-panel">
        <h2>ë¦´ë¼ì˜ í…ŒíŠ¸ë¦¬ìŠ¤</h2>

        <div class="next-preview" id="next-preview"></div>

        <h3>Score: <span id="score">0</span></h3>

        <p style="font-size:0.8em">
            â† â†’ ì´ë™<br>
            â†‘ íšŒì „<br>
            â†“ ë‚´ë¦¬ê¸°<br>
            Space ë‚™í•˜
        </p>

        <button id="start-button">ê²Œì„ ì‹œì‘</button>
    </div>
</div>

<!-- ğŸ“± ëª¨ë°”ì¼ ë²„íŠ¼ -->
<div class="mobile-controls">
    <div class="row">
        <button data-action="rotate">â†‘</button>
    </div>
    <div class="row">
        <button data-action="left">â†</button>
        <button data-action="down">â†“</button>
        <button data-action="right">â†’</button>
    </div>
    <div class="row">
        <button data-action="drop" class="drop">DROP</button>
    </div>
</div>

<script>
const COLS=10, ROWS=20;
const board=document.getElementById('game-board');
const preview=document.getElementById('next-preview');
const scoreEl=document.getElementById('score');
const startBtn=document.getElementById('start-button');

let grid=[], current=null, next=null, score=0, interval=null;

const SHAPES=[
 {m:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],c:'i-block'},
 {m:[[1,1],[1,1]],c:'o-block'},
 {m:[[0,1,0],[1,1,1],[0,0,0]],c:'t-block'},
 {m:[[0,1,1],[1,1,0],[0,0,0]],c:'s-block'},
 {m:[[1,1,0],[0,1,1],[0,0,0]],c:'z-block'},
 {m:[[1,0,0],[1,1,1],[0,0,0]],c:'j-block'},
 {m:[[0,0,1],[1,1,1],[0,0,0]],c:'l-block'}
];

function init(){
    grid=Array.from({length:ROWS},()=>Array(COLS).fill(0));
    score=0;
    scoreEl.textContent=score;
    draw();
}

function newBlock(){
    const t=SHAPES[Math.floor(Math.random()*7)];
    return {m:JSON.parse(JSON.stringify(t.m)),c:t.c,r:0,col:3};
}

function canMove(r,c,m){
    for(let y=0;y<m.length;y++)
    for(let x=0;x<m[y].length;x++)
        if(m[y][x]){
            const nr=r+y,nc=c+x;
            if(nc<0||nc>=COLS||nr>=ROWS||(nr>=0&&grid[nr][nc])) return false;
        }
    return true;
}

function freeze(){
    current.m.forEach((row,y)=>{
        row.forEach((v,x)=>{
            if(v) grid[current.r+y][current.col+x]=current.c;
        });
    });

    for(let r=ROWS-1;r>=0;r--){
        if(grid[r].every(v=>v)){
            grid.splice(r,1);
            grid.unshift(Array(COLS).fill(0));
            score+=100;
            scoreEl.textContent=score;
            r++;
        }
    }
}

function down(){
    if(canMove(current.r+1,current.col,current.m)) current.r++;
    else{
        freeze();
        current=next;
        next=newBlock();
        drawPreview();
        if(!canMove(current.r,current.col,current.m)){
            clearInterval(interval);
            alert("ê²Œì„ ì˜¤ë²„!\nì ìˆ˜: "+score);
            current=null;
        }
    }
    draw();
}

function draw(){
    board.innerHTML='';
    for(let r=0;r<ROWS;r++)
        for(let c=0;c<COLS;c++){
            const d=document.createElement('div');
            d.className='cell'+(grid[r][c]?' block '+grid[r][c]:'');
            board.appendChild(d);
        }

    if(current){
        current.m.forEach((row,y)=>{
            row.forEach((v,x)=>{
                if(v){
                    const i=(current.r+y)*COLS+(current.col+x);
                    if(board.children[i])
                        board.children[i].classList.add('block',current.c);
                }
            });
        });
    }
}

function drawPreview(){
    preview.innerHTML='';
    for(let i=0;i<16;i++) preview.appendChild(document.createElement('div'));
    next.m.forEach((row,y)=>{
        row.forEach((v,x)=>{
            if(v) preview.children[y*4+x].classList.add('block',next.c);
        });
    });
}

/* í‚¤ë³´ë“œ */
document.addEventListener('keydown',e=>{
    if(!current) return;
    if(e.key==='ArrowLeft'&&canMove(current.r,current.col-1,current.m)) current.col--;
    if(e.key==='ArrowRight'&&canMove(current.r,current.col+1,current.m)) current.col++;
    if(e.key==='ArrowDown') down();
    if(e.key==='ArrowUp'){
        const rot=current.m[0].map((_,i)=>current.m.map(r=>r[i]).reverse());
        if(canMove(current.r,current.col,rot)) current.m=rot;
    }
    if(e.key===' '){
        while(canMove(current.r+1,current.col,current.m)) current.r++;
        down();
    }
    draw();
});

/* ëª¨ë°”ì¼ ë²„íŠ¼ */
document.querySelectorAll('.mobile-controls button').forEach(b=>{
    b.addEventListener('touchstart',e=>{
        e.preventDefault();
        if(!current) return;
        const a=b.dataset.action;
        if(a==='left'&&canMove(current.r,current.col-1,current.m)) current.col--;
        if(a==='right'&&canMove(current.r,current.col+1,current.m)) current.col++;
        if(a==='down') down();
        if(a==='rotate'){
            const rot=current.m[0].map((_,i)=>current.m.map(r=>r[i]).reverse());
            if(canMove(current.r,current.col,rot)) current.m=rot;
        }
        if(a==='drop'){
            while(canMove(current.r+1,current.col,current.m)) current.r++;
            down();
        }
        draw();
    });
});

startBtn.onclick=()=>{
    init();
    current=newBlock();
    next=newBlock();
    drawPreview();
    draw();
    clearInterval(interval);
    interval=setInterval(down,800);
};
</script>

</body>
</html>
